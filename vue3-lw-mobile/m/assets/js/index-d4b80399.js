import{a as e,_ as t,b as s}from"../index-b355da82.js";import{v as a}from"./_@vue_runtime-dom@3.3.11@@vue-75e0886e.js";import{N as n,D as o,E as i,G as l,r,J as d,M as c,u,I as m,O as p,x as h}from"./_@vue_runtime-core@3.3.11@@vue-724baf7c.js";const{get:f,post:g,put:v,del:y}=e,w="/assistant";function _(e){return g(w+"/msg/list",{msg:{content:e.keywords},...e})}function x(e){return f(w+"/msg/get/"+e.sessionId,e).then((e=>{var t;return null==(t=e.data)||t.forEach((e=>{e.text=e.content})),e}))}function k(e){return g(w+"/msg/del/",{sessionId:e})}function I(e){return g(w+"/msg/collection",e)}function L(e){return g(w+"/msg/collection/list",{msg:{content:e.keywords},...e}).then((e=>{var t;let s=[];return null==(t=null==e?void 0:e.rows)||t.forEach((e=>{s.push(...e.contentList)})),null==s||s.forEach((e=>{e.text=e.content})),e.rows=s,e}))}const b={components:{History:n((()=>s((()=>import("./History-2477a9f4.js")),["assets/js/History-2477a9f4.js","assets/index-b355da82.js","assets/js/_@vue_runtime-dom@3.3.11@@vue-75e0886e.js","assets/js/_@vue_runtime-core@3.3.11@@vue-724baf7c.js","assets/js/_@vue_reactivity@3.3.11@@vue-4dc2fb75.js","assets/js/_@vue_shared@3.3.11@@vue-c40e50ba.js","assets/js/_pinia@2.1.7@pinia-1508863f.js","assets/js/_vue-demi@0.14.6@vue-demi-71ba0ef2.js","assets/js/_vue-router@4.2.5@vue-router-79fdc450.js","assets/js/_vant@4.8.0@vant-38f95c08.js","assets/js/_@vant_use@1.6.0@@vant-ee63bb3a.js","assets/js/_@vant_popperjs@1.3.0@@vant-afbd2e22.js","assets/css/_vant@4.8-dad1db4b.css","assets/js/_@vueuse_core@10.7.0@@vueuse-c5c5b2cd.js","assets/js/_@vueuse_shared@10.7.0@@vueuse-12ca11fe.js","assets/js/_vconsole@3.15.1@vconsole-24c60b35.js","assets/css/index-710b2243.css","assets/css/_normalize.css@8.0.1@normalize-9d9ae4af.css","assets/css/History-3ce01fe7.css"]))),MessageList:n((()=>s((()=>import("./MessageList-6dc80dca.js")),["assets/js/MessageList-6dc80dca.js","assets/index-b355da82.js","assets/js/_@vue_runtime-dom@3.3.11@@vue-75e0886e.js","assets/js/_@vue_runtime-core@3.3.11@@vue-724baf7c.js","assets/js/_@vue_reactivity@3.3.11@@vue-4dc2fb75.js","assets/js/_@vue_shared@3.3.11@@vue-c40e50ba.js","assets/js/_pinia@2.1.7@pinia-1508863f.js","assets/js/_vue-demi@0.14.6@vue-demi-71ba0ef2.js","assets/js/_vue-router@4.2.5@vue-router-79fdc450.js","assets/js/_vant@4.8.0@vant-38f95c08.js","assets/js/_@vant_use@1.6.0@@vant-ee63bb3a.js","assets/js/_@vant_popperjs@1.3.0@@vant-afbd2e22.js","assets/css/_vant@4.8-dad1db4b.css","assets/js/_@vueuse_core@10.7.0@@vueuse-c5c5b2cd.js","assets/js/_@vueuse_shared@10.7.0@@vueuse-12ca11fe.js","assets/js/_vconsole@3.15.1@vconsole-24c60b35.js","assets/css/index-710b2243.css","assets/css/_normalize.css@8.0.1@normalize-9d9ae4af.css","assets/css/MessageList-25a199c9.css"])))},data:()=>({getCollectList:L,active:"0",loading:!1,sessionId:"",keywords:"",list:[],answer:{text:"",sendTime:""}}),computed:{},watch:{},created(){},mounted(){},methods:{createDialog(){var e;(e=this.sessionId)&&f(w+"/close/connect/"+e),this.keywords="",this.sessionId="",this.list=[]},send(){this.loading=!0,this.list.push({text:this.keywords,role:"user"});let e=this.answer;this.list.push(e),function(e,t){const s=new XMLHttpRequest;s.timeout=3e4,s.open("POST",window.lwConfig.BASE_API+window.lwConfig.services.ai+"/assistant/send/msg"),s.setRequestHeader("Authorization","Bearer "+sessionStorage.token),s.setRequestHeader("Content-type","application/json"),s.setRequestHeader("Accept","text/event-stream"),s.onprogress=a=>{if(s.readyState===XMLHttpRequest.LOADING){const e=s.responseText.split("\n\n").map((e=>{const t=e.split("\n"),s={};return t.forEach((e=>{if(e.startsWith("data:{"))s.data=JSON.parse(e.slice(e.indexOf("{")));else{const[t,a]=e.split(":");s[t]=a}})),s}));null==t||t({code:200,data:e})}s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE)if(200!==s.status)null==t||t({code:s.status,data:e});else try{let e=JSON.parse(s.responseText);200!=e.code&&(null==t||t(e))}catch(a){}}},s.send(JSON.stringify(e))}({sessionId:this.sessionId,msg:{content:this.keywords,role:"user"}},(({code:t,data:s})=>{200==t?(e.text="",s.forEach(((t,a)=>{var n,o,i,l,r;"msg"==t.event&&(e.text+=null==(o=null==(n=t.data)?void 0:n.choices)?void 0:o[0].delta.content,"stop"==(null==(l=null==(i=t.data)?void 0:i.choices)?void 0:l[0].finishReason)&&(e.sendTime=(new Date).toLocaleString(),e.msgId=null==(r=t.data)?void 0:r.id,this.loading=!1,this.keywords="",this.answer={text:"",sendTime:""},this.sessionId||(this.sessionId=s[0].data)))}))):(this.loading=!1,e.text="回答失败，可以换个措辞试一试哦~",this.answer={text:"",sendTime:""})}))}}},E={class:"main"},O={style:{flex:"auto",overflow:"hidden",padding:"0 15px"}},S={key:0,class:"footer bfc-o fxnone"};const R=t(b,[["render",function(e,t,s,n,f,g){const v=o("van-tab"),y=o("van-tabs"),w=o("MessageList"),_=o("History"),x=o("PullRefreshScrollLoadList"),k=o("van-button"),I=o("van-field");return i(),l("div",E,[r(y,{class:"mb15",active:f.active,"onUpdate:active":t[0]||(t[0]=e=>f.active=e)},{default:d((()=>[r(v,{title:"AI 对话",name:"0"}),r(v,{title:"历史对话",name:"1"}),r(v,{title:"我的收藏",name:"2"})])),_:1},8,["active"]),c("div",O,[u(r(w,{class:"",isDefault:"",list:f.list},null,8,["list"]),[[a,0==f.active]]),1==f.active?(i(),m(_,{key:0})):p("",!0),2==f.active?(i(),m(x,{key:1,params:{collection:1},request:f.getCollectList},{list:d((({list:e})=>[r(w,{list:e},null,8,["list"])])),_:1},8,["request"])):p("",!0)]),0==f.active?(i(),l("div",S,[r(k,{class:"ml10 mb10",type:"primary",plain:"",onClick:g.createDialog},{default:d((()=>[h("新建对话")])),_:1},8,["onClick"]),r(I,{class:"textarea",type:"textarea",modelValue:f.keywords,"onUpdate:modelValue":t[1]||(t[1]=e=>f.keywords=e),placeholder:"请输入",maxlength:200,"show-word-limit":!1,rows:"1",autosize:""},null,8,["modelValue"]),r(k,{class:"send",type:f.keywords?"primary":"default",disabled:!f.keywords,loading:f.loading,onClick:g.send},{default:d((()=>[h(" 发送 ")])),_:1},8,["type","disabled","loading","onClick"])])):p("",!0)])}],["__scopeId","data-v-56667e0c"]]),T=Object.freeze(Object.defineProperty({__proto__:null,default:R},Symbol.toStringTag,{value:"Module"}));export{x as a,I as c,_ as g,T as i,k as r};
